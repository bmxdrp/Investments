---
// Sidebar.astro
interface Props {
  activePage: string;
}

const { activePage } = Astro.props;

const menuItems = [
  {
    name: "Dashboard",
    href: "/dashboard",
    icon: "dashboard",
    page: "dashboard",
  },
  {
    name: "Cuentas",
    href: "/dashboard/accounts",
    icon: "accounts",
    page: "accounts",
  },
  {
    name: "Aportes",
    href: "/dashboard/contribute",
    icon: "contribute",
    page: "contribute",
  },
  {
    name: "Retiros",
    href: "/dashboard/withdraw",
    icon: "withdraw",
    page: "withdraw",
  },
  {
    name: "Transferencias",
    href: "/dashboard/transfer",
    icon: "transfer",
    page: "transfer",
  }, // Enlace agregado para consistencia
  {
    name: "Actividad",
    href: "/dashboard/activity",
    icon: "activity",
    page: "activity",
  },
  { name: "Metas", href: "/dashboard/goals", icon: "goals", page: "goals" },
  {
    name: "Alertas",
    href: "/dashboard/alerts",
    icon: "alerts",
    page: "alerts",
  },
  {
    name: "Ajustes",
    href: "/dashboard/settings",
    icon: "settings",
    page: "settings",
  },
];
---

<!-- Mobile Menu Button with Zen Blur -->
<button
  id="mobile-menu-button"
  type="button"
  class="fixed top-4 left-4 z-50 lg:hidden p-2.5 rounded-xl bg-white/90 backdrop-blur-md shadow-sm border border-stone-200 text-stone-600 hover:text-stone-900 transition-all hover:scale-105 active:scale-95"
>
  <svg
    id="menu-open-icon"
    class="w-6 h-6"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M4 6h16M4 12h16M4 18h16"></path>
  </svg>
  <svg
    id="menu-close-icon"
    class="w-6 h-6 hidden"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M6 18L18 6M6 6l12 12"></path>
  </svg>
</button>

<!-- Overlay with Smooth Fade -->
<div
  id="sidebar-overlay"
  class="fixed inset-0 bg-stone-900/40 backdrop-blur-sm z-40 lg:hidden hidden transition-opacity duration-300"
>
</div>

<!-- Sidebar: Zen Design -->
<aside id="sidebar" class="h-full flex flex-col bg-white">
  <!-- Header Minimalista -->
  <div class="flex items-center gap-4 px-8 py-8">
    <div class="relative group">
      <div
        class="absolute -inset-1 bg-gradient-to-r from-blue-100 to-indigo-100 rounded-2xl blur-sm opacity-50 group-hover:opacity-100 transition duration-500"
      >
      </div>
      <img
        src="/logo.png"
        alt="Capyte"
        class="relative w-12 h-12 rounded-xl shadow-sm bg-white p-1"
      />
    </div>
    <div>
      <h2 class="text-xl font-bold text-stone-900 tracking-tight">Capyte</h2>
      <p class="text-xs font-medium text-stone-400 uppercase tracking-widest">
        Finance
      </p>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="flex-1 overflow-y-auto px-4 py-2 custom-scrollbar">
    <ul class="space-y-1.5">
      {
        menuItems.map((item) => {
          const isActive = activePage === item.page;
          return (
            <li>
              <a
                href={item.href}
                class={`group flex items-center gap-3.5 px-4 py-3.5 rounded-2xl transition-all duration-300 ease-out
                ${
                  isActive
                    ? "bg-slate-900 text-white shadow-lg shadow-slate-900/20 translate-x-1"
                    : "text-stone-500 hover:bg-stone-50 hover:text-stone-900 hover:translate-x-1"
                }
              `}
              >
                <div
                  class={`transition-transform duration-300 ${isActive ? "scale-110" : "group-hover:scale-110"}`}
                >
                  {/* ICONOS */}
                  {item.icon === "dashboard" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
                      />
                    </svg>
                  )}
                  {item.icon === "accounts" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                      />
                    </svg>
                  )}
                  {item.icon === "contribute" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M12 6v6m0 0v6m0-6h6m-6 0H6"
                      />
                    </svg>
                  )}
                  {item.icon === "withdraw" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M20 12H4"
                      />
                    </svg>
                  )}
                  {item.icon === "transfer" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"
                      />
                    </svg>
                  )}
                  {item.icon === "activity" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                      />
                    </svg>
                  )}
                  {item.icon === "goals" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
                      />
                    </svg>
                  )}
                  {item.icon === "alerts" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"
                      />
                    </svg>
                  )}
                  {item.icon === "settings" && (
                    <svg
                      class="w-5 h-5"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                      />
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                      />
                    </svg>
                  )}
                </div>
                <span class="font-medium tracking-wide text-sm">
                  {item.name}
                </span>
              </a>
            </li>
          );
        })
      }
    </ul>
  </nav>

  <!-- User Section Minimal -->
  <div class="p-6 border-t border-stone-100">
    <a
      href="/auth/logout"
      class="group flex items-center gap-3 px-4 py-3 text-stone-400 hover:text-red-500 rounded-xl transition-all hover:bg-red-50"
    >
      <svg
        class="w-5 h-5 transition-transform group-hover:-translate-x-1"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
        ><path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
        ></path></svg
      >
      <span class="font-medium text-sm">Cerrar Sesi√≥n</span>
    </a>
  </div>
</aside>

<!-- No script needed for Client Router logic, but kept for mobile menu toggle -->
<script>
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("sidebar-overlay");
  const menuButton = document.getElementById("mobile-menu-button");
  const closeButton = document.getElementById("sidebar-close-button"); // Removed from HTML but good safety
  const menuOpenIcon = document.getElementById("menu-open-icon");
  const menuCloseIcon = document.getElementById("menu-close-icon");

  function openSidebar() {
    // Mobile logic: transform class needs to be handled differently if we changed the sidebar structure
    // Since we removed the specialized mobile styling in CSS for the sake of Zen upgrade,
    // we need to ensure the mobile classes are applied correctly.
    // Assuming the sidebar has a wrapper or we toggle classes on it.

    // For simplicity in this Zen update:
    sidebar?.classList.add("translate-x-0");
    sidebar?.classList.remove("-translate-x-full");

    // Mobile positioning classes (override desktop defaults if needed)
    sidebar?.classList.add(
      "fixed",
      "z-50",
      "inset-y-0",
      "left-0",
      "w-72",
      "shadow-2xl",
    );

    overlay?.classList.remove("hidden");
    menuOpenIcon?.classList.add("hidden");
    menuCloseIcon?.classList.remove("hidden");
    document.body.style.overflow = "hidden";
  }

  function closeSidebar() {
    sidebar?.classList.remove("translate-x-0");
    sidebar?.classList.add("-translate-x-full");

    // Clean up mobile specific classes so desktop layout isn't affected if resized
    // sidebar?.classList.remove("fixed", "z-50", "inset-y-0", "left-0", "w-72", "shadow-2xl");
    // Actually, on desktop strict mode, these classes might be fine if hidden, but let's be safe.

    overlay?.classList.add("hidden");
    menuOpenIcon?.classList.remove("hidden");
    menuCloseIcon?.classList.add("hidden");
    document.body.style.overflow = "";
  }

  menuButton?.addEventListener("click", () => {
    if (menuOpenIcon?.classList.contains("hidden")) {
      closeSidebar();
    } else {
      openSidebar();
    }
  });

  overlay?.addEventListener("click", closeSidebar);
</script>

<style>
  /* Sidebar Mobile Default State: Hidden off-canvas */
  @media (max-width: 1024px) {
    #sidebar {
      position: fixed;
      top: 0;
      left: 0;
      height: 100vh;
      z-index: 50;
      width: 18rem; /* w-72 */
      transform: translateX(-100%);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
    }
    #sidebar.translate-x-0 {
      transform: translateX(0);
    }
  }
</style>
