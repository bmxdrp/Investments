---
import Layout from "@layouts/home.astro";
const returnTo = Astro.url.searchParams.get("returnTo") || "/";
const safeReturnTo = returnTo.startsWith("/") ? returnTo : "/";
const error = Astro.url.searchParams.get("error") || null;
const success = Astro.url.searchParams.get("success") || null;
---

<Layout title="Register">
  <div
    class="min-h-screen flex items-center justify-center px-4 sm:px-6 lg:px-8 py-8 sm:py-12"
  >
    <div
      class="w-full max-w-md bg-white/10 backdrop-blur-xl border border-white/20
             shadow-2xl rounded-2xl p-6 sm:p-8 animate-fadeIn"
    >
      <h1 class="text-2xl sm:text-3xl font-bold text-white text-center mb-2">
        Bienvenido
      </h1>
      <p class="text-sm sm:text-base text-slate-300 text-center mb-6">
        Regístrate para acceder al panel administrativo
      </p>

      <form
        method="POST"
        action={`/api/auth/register?returnTo=${encodeURIComponent("/auth/login")}`}
        class="space-y-4 sm:space-y-5"
      >
        <!-- Email -->
        <div>
          <label class="text-slate-200 text-sm mb-1 block">Correo</label>
          <input
            type="email"
            name="email"
            required
            placeholder="tucorreo@mail.com"
            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl bg-white/20 border border-white/20
                   text-white placeholder-slate-300 focus:outline-none focus:ring-2
                   focus:ring-blue-400 text-sm sm:text-base"
          />
        </div>

        <!-- Password -->
        <div>
          <label class="text-slate-200 text-sm mb-1 block">Contraseña</label>
          <input
            type="password"
            name="password"
            required
            placeholder="••••••••"
            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl bg-white/20 border border-white/20
                   text-white placeholder-slate-300 focus:outline-none focus:ring-2
                   focus:ring-blue-400 text-sm sm:text-base"
          />
        </div>

        <!-- Confirmar Password -->
        <div>
          <label class="text-slate-200 text-sm mb-1 block"
            >Confirmar contraseña</label
          >
          <input
            type="password"
            name="password_confirm"
            required
            placeholder="••••••••"
            class="w-full px-3 sm:px-4 py-2.5 sm:py-3 rounded-xl bg-white/20 border border-white/20
                   text-white placeholder-slate-300 focus:outline-none focus:ring-2
                   focus:ring-blue-400 text-sm sm:text-base"
          />
        </div>

        <!-- Botón registro -->
        <button
          type="submit"
          class="w-full py-2.5 sm:py-3 rounded-xl bg-blue-500 hover:bg-blue-600 transition
                 text-white font-semibold shadow-lg text-sm sm:text-base"
        >
          Crear Cuenta
        </button>
      </form>

      {
        success === "1" && (
          <div class="bg-green-50 border border-green-200 mt-4 rounded-lg p-3 flex items-start gap-2 sm:gap-3">
            <svg
              class="h-5 w-5 text-green-400 shrink-0 mt-0.5"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                clip-rule="evenodd"
              />
            </svg>
            <div>
              <p class="text-sm font-medium text-green-800">
                Usuario registrado con éxito.
              </p>
              <p class="text-xs sm:text-sm text-green-700 mt-0.5">
                Ya puedes{" "}
                <a
                  href="/auth/login"
                  class="text-blue-600 hover:underline font-medium"
                >
                  iniciar sesión
                </a>
                .
              </p>
            </div>
          </div>
        )
      }

      {
        error && (
          <div class="bg-red-50 border border-red-200 mt-4 rounded-lg p-3 flex items-start gap-2 sm:gap-3">
            <svg
              class="h-5 w-5 text-red-500 shrink-0 mt-0.5"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                clip-rule="evenodd"
              />
            </svg>
            <div>
              <p class="text-sm font-medium text-red-800">
                Error al realizar la operación
              </p>
              {error && (
                <p class="mt-1 text-xs sm:text-sm text-red-700">
                  {decodeURIComponent(error)}
                </p>
              )}
            </div>
          </div>
        )
      }
    </div>
  </div>

  <style>
    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .animate-fadeIn {
      animation: fadeIn 0.7s ease-out forwards;
    }
  </style>
</Layout>
